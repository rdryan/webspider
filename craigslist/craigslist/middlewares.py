# Importing base64 library because we'll need it ONLY in case if the proxy we are going to use requires authentication
import base64
import random

PROXIES = [
#{'ip_port': '12.34.56.78:80', 'user_pass': 'username:password'},
#{'ip_port': 'localhost:8087', 'user_pass': None},
{'ip_port': 'localhost:8087'},
{'ip_port': '60.191.209.147:81'},
{'ip_port': '222.88.236.234:81'},
{'ip_port': '101.26.38.162:80'},
{'ip_port': '221.228.205.98:3128'},
{'ip_port': '134.196.160.82:3128'},
{'ip_port': '218.77.83.89:3128'},
{'ip_port': '59.48.106.194:9797'},
{'ip_port': '183.224.77.75:3128'},
{'ip_port': '221.176.174.46:3128'},
{'ip_port': '59.78.160.247:8080'},
{'ip_port': '166.111.134.46:3128'},
{'ip_port': '117.177.243.14:8083'},
{'ip_port': '118.144.177.254:3128'},
{'ip_port': '112.25.41.136:80'},
{'ip_port': '114.215.150.13:3128'},
{'ip_port': '117.166.106.142:8123'},
{'ip_port': '117.177.250.146:8081'},
{'ip_port': '222.59.246.38:8118'},
{'ip_port': '115.182.41.36:8080'},
{'ip_port': '222.222.251.131:9797'},
{'ip_port': '39.168.158.36:8123'},
{'ip_port': '118.126.142.209:3128'},
{'ip_port': '123.57.23.114:80'},
{'ip_port': '112.90.146.76:3128'},
{'ip_port': '59.61.80.78:9797'},
{'ip_port': '117.165.244.117:8123'},
{'ip_port': '222.74.21.36:3128'},
{'ip_port': '123.57.23.114:8080'},
{'ip_port': '123.126.108.190:3128'},
{'ip_port': '211.141.64.50:80'},
{'ip_port': '183.62.62.188:9797'},
{'ip_port': '101.226.249.237:80'},
{'ip_port': '112.15.73.221:8123'},
{'ip_port': '202.100.167.135:80'},
{'ip_port': '120.55.193.40:80'},
{'ip_port': '218.92.227.165:24809'},
{'ip_port': '58.214.5.229:80'},
{'ip_port': '123.114.161.72:3128'},
{'ip_port': '60.2.193.194:9797'},
{'ip_port': '222.222.251.185:9797'},
{'ip_port': '211.71.30.97:3128'},
{'ip_port': '202.100.167.170:80'},
{'ip_port': '175.25.171.173:8090'},
{'ip_port': '39.158.97.89:8123'},
{'ip_port': '202.100.167.172:80'},
{'ip_port': '119.188.115.27:80'},
{'ip_port': '117.162.201.96:8123'},
{'ip_port': '202.100.167.159:80'},
{'ip_port': '223.82.15.15:8123'},
{'ip_port': '117.167.73.119:8123'},
{'ip_port': '59.78.160.247:8080'},
{'ip_port': '117.168.39.245:8123'},
{'ip_port': '202.100.167.143:80'},
{'ip_port': '113.200.29.10:9999'},
{'ip_port': '182.92.150.236:3128'},
{'ip_port': '59.39.88.190:8080'},
{'ip_port': '202.100.167.178:80'},
{'ip_port': '202.100.167.144:80'},
{'ip_port': '220.249.185.178:9797'},
{'ip_port': '223.84.54.59:8123'},
{'ip_port': '59.173.13.153:8081'},
{'ip_port': '117.165.144.185:8123'},
{'ip_port': '101.200.234.114:8080'},
{'ip_port': '202.100.167.158:80'},
{'ip_port': '202.106.16.36:3128'},
{'ip_port': '39.182.200.117:8123'},
{'ip_port': '180.166.112.47:8888'},
{'ip_port': '119.147.161.55:3128'},
{'ip_port': '222.34.3.11:8080'},
{'ip_port': '221.7.13.194:3128'},
{'ip_port': '222.178.152.31:8080'},
{'ip_port': '59.78.160.247:8080'},
{'ip_port': '223.84.54.59:8123'},
{'ip_port': '202.100.167.135:80'},
{'ip_port': '118.244.151.157:3128'},
{'ip_port': '115.29.43.60:3128'},
{'ip_port': '202.100.167.143:80'},
{'ip_port': '39.167.248.113:8123'},
{'ip_port': '202.106.16.36:3128'},
{'ip_port': '166.111.134.46:3128'},
{'ip_port': '120.55.193.40:80'},
{'ip_port': '218.92.227.165:12946'},
{'ip_port': '117.178.72.100:8123'},
{'ip_port': '39.158.140.48:8123'},
{'ip_port': '113.200.250.112:80'},
{'ip_port': '202.100.167.144:80'},
{'ip_port': '117.168.115.108:8123'},
{'ip_port': '117.158.1.210:9797'},
{'ip_port': '202.100.167.145:80'},
{'ip_port': '117.163.116.121:8123'},
{'ip_port': '202.100.167.178:80'},
{'ip_port': '223.82.15.15:8123'},
{'ip_port': '123.57.163.10:3128'},
{'ip_port': '183.54.30.232:9797'},
{'ip_port': '202.100.167.158:80'},
{'ip_port': '112.124.22.31:3128'},
{'ip_port': '119.253.252.23:3128'},
{'ip_port': '110.206.127.136:9797'},
{'ip_port': '115.231.65.16:8080'},
{'ip_port': '58.218.198.61:808'},
{'ip_port': '202.100.167.172:80'},
{'ip_port': '39.158.97.89:8123'},
{'ip_port': '117.165.83.65:8123'},
{'ip_port': '61.179.110.8:8081'},
{'ip_port': '183.185.182.209:9797'},
{'ip_port': '202.100.167.170:80'},
{'ip_port': '119.188.115.27:80'},
{'ip_port': '111.199.156.88:3128'},
{'ip_port': '59.78.160.244:8080'},
{'ip_port': '101.226.249.237:80'},
{'ip_port': '117.166.106.142:8123'},
{'ip_port': '117.165.144.185:8123'},
{'ip_port': '61.158.173.14:8080'},
{'ip_port': '39.176.213.20:8123'},
{'ip_port': '101.200.234.114:8080'},
{'ip_port': '223.82.176.103:8123'},
{'ip_port': '222.222.251.185:9797'},
{'ip_port': '119.135.185.98:9999'},
{'ip_port': '112.101.80.171:9797'},
{'ip_port': '202.100.167.167:80'},
{'ip_port': '117.79.224.69:3128'},
{'ip_port': '202.100.167.182:80'},
{'ip_port': '202.100.167.142:80'},
{'ip_port': '39.182.200.117:8123'},
{'ip_port': '60.29.248.142:8080'},
{'ip_port': '117.163.239.15:8123'},
{'ip_port': '211.141.64.50:80'},
{'ip_port': '113.200.250.112:8080'},
{'ip_port': '39.177.63.135:8123'},
{'ip_port': '117.166.168.132:8123'},
{'ip_port': '117.162.201.96:8123'},
{'ip_port': '117.170.133.4:8123'},
{'ip_port': '202.100.167.168:80'},
{'ip_port': '58.243.0.162:9999'},
{'ip_port': '119.253.252.29:3128'},
{'ip_port': '202.100.167.137:80'},
{'ip_port': '222.34.3.12:8080'},
{'ip_port': '123.57.23.114:3128'},
{'ip_port': '119.147.161.55:3128'},
{'ip_port': '124.131.221.142:9999'},
{'ip_port': '222.83.14.145:3128'},
{'ip_port': '221.228.205.98:3128'},
{'ip_port': '222.222.251.185:9999'},
{'ip_port': '113.200.81.85:9999'},
{'ip_port': '202.100.167.171:80'},
{'ip_port': '123.126.108.190:3128'},
{'ip_port': '211.71.30.97:3128'},
{'ip_port': '182.92.148.71:3128'},
{'ip_port': '124.115.211.30:9797'},
{'ip_port': '219.155.46.234:9999'},
{'ip_port': '106.37.177.251:3128'},
{'ip_port': '59.39.88.190:8080'},
{'ip_port': '27.221.31.78:8080'},
{'ip_port': '39.166.17.237:8123'},
{'ip_port': '183.237.51.149:3128'},
{'ip_port': '117.169.185.163:8123'},
{'ip_port': '106.39.160.104:80'},
{'ip_port': '117.171.20.229:8123'},
{'ip_port': '58.20.57.104:3128'},
{'ip_port': '211.144.72.154:8080'},
{'ip_port': '221.237.154.57:9999'},
{'ip_port': '113.200.29.10:9999'},
{'ip_port': '220.249.185.178:9797'},

]


# Start your middleware class
class ProxyMiddleware(object):
    # overwrite process request
    def process_request(self, request, spider):
        # Set the location of the proxy
        #request.meta['proxy'] = "http://localhost:8087"
 
        p = random.choice(PROXIES)

        #if p['user_pass'] is not None:
        #    request.meta['proxy'] = "http://%s" % p['ip_port']
        #    encoded_user_pass = base64.encodestring(p['user_pass'])
        #    request.headers['Proxy-Authorization'] = 'Basic ' + encoded_user_pass
        #else:
        #    request.meta['proxy'] = "http://%s" % p['ip_port']
        
        request.meta['proxy'] = "http://%s" % p['ip_port']

